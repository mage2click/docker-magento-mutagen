##Magento 1
Run one of the commands below from the directory you want to install your project to. Existing projects can be imported as well.
### Interactive mode

```bash
curl -s https://raw.githubusercontent.com/mage2click/docker-magento-mutagen/feature/magento-1/lib/setup-m-1 | bash -s -- -i
```

The `-i` flag above (shorthand of `--interactive`) defines that setup script must be launched in interactive mode.  
Simply follow the steps during setup initialisation to configure resulted Magento development environment.

### One-line mode 

```bash
curl -s https://raw.githubusercontent.com/mage2click/docker-magento-mutagen/feature/magento-1/lib/setup-m-1 | bash -s -- --domain=magento1.test
```

The `--domain=magento1.test` above defines the hostname to use.  
Script accepts also other parameters and flags to configure resulted Magento development environment.

Parameters:  
- `--domain=<domain>` Domain to use for the project, default is `magento1.test`.
- `--php-version=<version>` PHP version to use for the project, default is `5.6`. Currently supported PHP versions: `5.6`, `7.0`, `7.1` and `7.2`.
- `--elasticsearch-version=<version>` Elasticsearch version to use for the project, default is `2.4`. Currently supported Elasticsearch versions: `2.4`, `5.6` and `6.7.2`. All versions have the [analysis-phonetic](https://www.elastic.co/guide/en/elasticsearch/plugins/master/analysis-phonetic.html) plugin installed.
- `--magento-archive=<path>` Full path to downloaded Magento zip-archive to use in setup (optional).
- `--magento-project=<path>` Full path to the existing Magento project to use in setup (optional).
- `--magento-db=<path>` Full path to sql-file with database dump to use in setup (optional).
- `--magento-version=<version>` Magento version to download from the official repository, default is `1.9.4.1`. If `--magento-archive` parameter is specified, this will be skipped.

Flags:
- `--varnish` Use Varnish cache.
- `--mailhog` Use MailHog email testing tool.
- `--rabbitmq` Use RabbitMQ message-broker.
- `--cron` Use cron service.
- `-i`, `--interactive` Start interactive setup.
- `-h`, `--help` Show usage information.

### Usage info output

```bash
curl -s https://raw.githubusercontent.com/mage2click/docker-magento-mutagen/feature/magento-1/lib/setup-m-1 | bash -s -- -h
```

The `-h` flag above (shorthand of `--help`) defines that setup script must only output usage information. This command won't start the installation process.


## Custom CLI Commands

- `bin/bash`: Drop into the bash prompt of your Docker container. The `phpfpm` container should be mainly used to access the filesystem within Docker.
- `bin/cli`: Run any CLI command without going into the bash prompt. Ex. `bin/cli ls`
- `bin/clinotty`: Run any CLI command with no TTY. Ex. `bin/clinotty chmod u+x somerandomfile.sh`
- `bin/composer`: Run the composer binary. Ex. `bin/composer install`
- `bin/copyfromcontainer`: Copy folders or files from container to host. Ex. `bin/copyfromcontainer vendor`
- `bin/copytocontainer`: Copy folders or files from host to container. Ex. `bin/copytocontainer --all`
- `bin/fixowns`: This will fix filesystem ownerships within the container.
- `bin/fixperms`: This will fix filesystem permissions within the container.
- `bin/grunt`: Run the grunt binary. Note that this runs the version from the node_modules directory for project version parity. Ex. `bin/grunt exec`
- `bin/magento`: Run the Magento CLI. Ex: `bin/magento cache:flush`
- `bin/mutagen`: Mutagen sync related commands. Accepts params `start`, `stop` or `flush`. Ex. `bin/mutagen start`
- `bin/node`: Run the node binary. Ex. `bin/node --version`
- `bin/npm`: Run the npm binary. Ex. `bin/npm install`
- `bin/redis`: Run a command from the redis container. Ex `bin/redis redis-cli monitor`
- `bin/remove`: Remove all stopped service containers. Accepts params `-v` or `--volumes` to remove volumes.
- `bin/restart`: Stop and then start all containers.
- `bin/root`: Run any CLI command as root without going into the bash prompt. Ex `bin/root apt-get install nano`
- `bin/rootnotty`: Run any CLI command as root with no TTY. Ex `bin/rootnotty chown -R app:app /var/www/html`
- `bin/self-update`: Alias for bin/update.
- `bin/selfupdate`: Alias for bin/update.
- `bin/start`: Start all containers, good practice to use this instead of `docker-compose up -d`, as it may contain additional helpers.
- `bin/status`: Check the container status.
- `bin/stop`: Stop all containers.
- `bin/update`: Update the contents of the bin folder with the latest changes from the master branch.
- `bin/varnish`: Run commands in the Varnish container. Ex `bin/varnish varnishlog -q 'ReqURL ~ "^/$"'` to monitor requests to homepage, or `bin/vanirsh varnishlog -g request -q 'ReqMethod eq "PURGE"'` to monitor PURGE requests.
- `bin/xdebug`: Disable or enable Xdebug. Accepts params `disable` (default) or `enable`. Ex. `bin/xdebug enable`.
- `bin/restart-nginx`: Restart the app container (nginx) to apply new changes to nginx.conf files (src/nginx.conf).

## Setup and Configuration CLI Commands

- `bin/setup/elasticsearch`: TBD Enable Elasticsearch as Search Engine (2.4 by default).
    #### Flags:
    - `2.4`: enable Elasticsearch 2.4
    - `5.6`: enable Elasticsearch 5.6
    - `6.7.2` or no flag: enable Elasticsearch 6.7.2
    
- `bin/setup/download`: Download & extract specific Magento version to the `src` directory. Ex. `bin/setup/download 1.9.4.1`
- `bin/setup/import`: Copy files of existing Magento project to the `src` directory. Ex. `bin/setup/import /path/to/magento/project`
- `bin/setup/redis`: TBD Enable Redis for Backend Cache, Page Cache and Session.
- `bin/setup/start`: Run the Magento setup process to install Magento from the source code, with the optional parameter `--domain=<domain>` (defaults to `magento1.test`). Ex. `bin/setup/start --domain=magento1.test` 
- `bin/setup/unzip`: Extract downloaded Magento zip-archive to the `src` directory. Ex. `bin/setup/unzip /path/to/magento.zip`
    #### Varnish:
    TBD:
    - `bin/setup/varnish` Varnish-related configurations and VCL-related actions   
        #### Flags: 
        - `--configure`: Apply required settings to enable Varnish as Caching Application for Full Page Cache and handle cache invalidations correctly
        - `--generate-vcl`: Generate the default.vcl file with the default Varnish config, save it to the var/default.vcl and copy from the phpfpm container to ./src/var/default.vcl .
        - `--list-vcl`: Show info from varnish container with the list of loaded VCLs, and active vcl.
        #### Parameters: 
        - `--apply-vcl`: Apply the specified VCL file with Varnish config (or default.vcl if no argument specified), with automated copying it from the ./src/var/ folder to the varnish container, also showing additional info about the list of loaded VCLs and active VCL before and after execution of this command.
        - `--copy-vcl`: Copy the specified file (or default.vcl if no argument specified) from the ./src/var/ folder to the varnish container. 
        - `--use-vcl`: Use the specified VCL (you should specify one of the names from the bin/setup/varnish --list-vcl output - for example "boot") as active config for varnish container.
